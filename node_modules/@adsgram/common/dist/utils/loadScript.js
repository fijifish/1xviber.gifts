import { MAX_ATTEMPTS, SAD_URL } from "../constants";
let scriptLoadPromise = null;
export function loadScript() {
    if (typeof window !== "undefined" && window.Adsgram) {
        return Promise.resolve();
    }
    if (scriptLoadPromise)
        return scriptLoadPromise;
    scriptLoadPromise = retryLoadScript(MAX_ATTEMPTS);
    return scriptLoadPromise;
}
function retryLoadScript(retries) {
    return new Promise((resolve, reject) => {
        const attemptLoad = (attempt) => {
            const script = document.createElement("script");
            script.src = SAD_URL;
            script.async = true;
            script.addEventListener("load", () => {
                if (window.Adsgram) {
                    resolve();
                }
                else {
                    if (attempt < retries) {
                        attemptLoad(attempt + 1);
                    }
                    else {
                        reject(new Error("Adsgram object not found after script load"));
                    }
                }
            });
            script.addEventListener("error", () => {
                if (attempt < retries) {
                    attemptLoad(attempt + 1);
                }
                else {
                    reject(new Error("Failed to load Adsgram script after retries"));
                }
            });
            document.head.append(script);
        };
        attemptLoad(1);
    });
}
